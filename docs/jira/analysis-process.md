---
layout: default
title: Jira问题分析标准流程
parent: 问题分析
nav_order: 1
---

## Jira问题标准分析流程（9步法）v2025.11.05 - 严格执行版

### 核心原则

1. **唯一性原则**：每个问题单只有一个分析文档，不创建多版本文件
2. **最新优先**：必须使用Jira最新评论中的日志和信息
3. **严禁口头分析**：必须查看原始Jira页面和完整日志
4. **结构化分析**：遵循统一的9个标准章节结构
5. **代码级定位**：定位到具体文件和行号
6. **禁止使用emoji**：技术文档保持专业性，不使用emoji表情符号
7. **禁止跳过步骤**：如果某个步骤无法完成（如日志下载失败），必须明确说明原因，请求用户协助，不得擅自跳过或用其他方式绕过
8. **PRD参考**：分析问题时如果不清楚产品规格或业务流程，应参考开机引导PRD文档（国内版：https://mi.feishu.cn/docx/S46IdxOZzoEmnxx5ZkEcaro0n2e 国际版：https://mi.feishu.cn/docx/CBGWdidZSoRrlmx4O3fcCg33nVc）

### 标准9步流程

#### 第1步：使用Playwright打开Jira

- 使用mcp_cursor-playwright工具访问问题单

#### 第2步：信息收集

- 收集Jira单号、机型、版本、复现概率、问题时间、最新评论中的日志链接等15+项信息
- 如果涉及产品规格或业务流程不清楚，参考PRD文档确认预期行为

#### 第3步：识别问题时间

- 提取精确的问题发生时间（YYYY/MM/DD HH:MM格式）
- **开机引导模块例外**：设备网络未连接，系统时间未同步，日志绝对时间戳可能不准确，但事件相对顺序和间隔可信

#### 第4步：下载日志（关键步骤，不可跳过）

- 从最新评论获取日志链接并下载（bugreport/logcat/tombstone等）
- **如果下载失败**：必须明确说明失败原因（认证问题、权限问题、网络问题等），停止分析流程，请求用户提供附件
- **绝对不允许**：在没有日志的情况下继续执行后续步骤

#### 第5步：视频和音频分析（优先，必须有视频文件）

- **视频分析**：使用ffmpeg自动提取帧，逐帧分析
- **关键帧截图**：提取关键帧并保存截图，在文档中贴图并说明问题现象
- **音频分析**：如果问题涉及声音，使用openai-whisper进行音频分析
- **界面确认**：通过视频确认问题所在的界面（Activity、Fragment、View等）和交互动作
- **操作时间标注**：标注每个交互动作对应的视频时间
- **如果视频下载失败**：明确说明原因，请求用户提供

#### 第6步：ADB自动化复现（可选，视情况执行）

- 参考文档：docs/操作手册/ADB设备自动化调试指南.md
- 仅在有真实设备连接且需要复现验证时执行

#### 第7步：日志分析（与视频100%对齐，核心步骤）

- **前置条件**：必须已经成功下载并解压bugreport日志
- 根据视频/ADB截图中的操作序列，在日志中找到对应的事件序列
- 分析Activity生命周期、系统服务调用、Accessibility事件、异常堆栈等
- **日志时间线必须不使用emoji表情符号，保持纯文本格式**

#### 第8步：代码走读并输出架构图

- **必须分析的内容**：正常流程代码、异常流程代码、关键方法调用、生命周期方法、状态管理、数据流向
- 如果涉及业务流程理解，参考PRD文档确认设计意图
- **架构图输出要求（使用PlantUML，直接嵌入分析文档）**：
  a) 流程时序图（Sequence Diagram）：展示模块交互、失败vs成功场景对比、修复前后对比
  b) 类关系图（Class Diagram）：展示关键类关系和模块边界
  c) 组件架构图（Component Diagram）：展示系统架构，包含数据流标注
  d) 数据流图（Data Flow Diagram）：展示数据在系统中的流动路径
  e) 控制流图（Control Flow Diagram）：展示程序执行的控制流程
  f) 状态迁移图（State Diagram）：展示服务/组件状态转换
  g) 线程模型图（Thread Model Diagram）：展示多线程交互和同步机制
  h) 进程模型图（Process Model Diagram）：展示进程间通信和交互
  i) 活动图（Activity Diagram）：展示判断流程、修复后流程
  j) 模块依赖图（Package/Module Dependency）：展示模块间依赖关系

#### 第9步：结构化日志分析并输出文档

- 按9个标准章节分析（信息收集→文档声明→日志分析→问题范围→根因与方案→测试验证→修复效果→相关文件→元数据）
- 在"问题范围"章节中，如果涉及产品规格判断，引用PRD文档说明

### 异常处理流程

当无法完成关键步骤时（下载失败、设备不可用等）：

1. 立即停止分析流程
2. 明确说明哪个步骤失败
3. 详细说明失败原因
4. 列出需要用户提供的内容
5. 等待用户提供必要资源后再继续

### 文档9个标准章节

1. **第一阶段：信息收集**
2. **第二阶段：文档声明**
3. **第三阶段：日志分析**（时间线/统计/间隔）
4. **第四阶段：问题范围分析**
5. **第五阶段：根因与解决方案**
6. **第六阶段：测试验证**（包含ADB自动化验证脚本）
7. **第七阶段：修复效果**
8. **第八阶段：相关文件**
9. **元数据**（分析人员/时间/版本）

---

## 日志时间线分析核心规范

### 标题规范

- 使用统一标题：**日志时间线分析（基于真实日志）**

### 问题时间点分析【重点】

1. **聚焦问题发生时间**：
   - 确定问题发生的准确时间点（如：09-24 19:05）
   - 分析该时间点前后5-10分钟的日志
   - 标注关键事件的时间戳

2. **时间窗口示例**：
   ```
   问题发生时间：2025-09-24 19:05
   分析窗口：2025-09-24 18:55 - 19:15
   
   18:55-19:00  系统正常运行阶段
   19:00-19:05  问题触发阶段（重点）
   19:05-19:10  问题发生后续影响
   19:10-19:15  系统响应/恢复尝试
   ```

3. **时间线日志搜索**：
   - 使用grep搜索问题时间点：`grep "09-24 19:0[0-9]"`
   - 扩大搜索范围：前后10-15分钟
   - 关注关键进程在该时间的日志

### 格式要求（强制）

1. **统一代码块**：所有日志必须在一个连贯的```log ... ```代码块中
2. **禁止拆分**：绝对不要用三级标题（###）拆分成独立章节
3. **阶段标注**：使用注释标注阶段，格式：`// {阶段描述}（{时间范围}）`
4. **时间范围标注**：每个阶段必须标注时间范围
5. **原始格式**：保留完整的原始日志格式，不要转换成表格
6. **时间戳**：保留完整时间戳（如：09-23 22:47:00.453）
7. **进程信息**：保留进程名称（如：MiuiWallpaper-ImageWallpaper、ActivityTaskManager等）

### 日志注释规范

1. **中文括号**：使用（）添加中文注释说明
2. **关键符号**（注意：技术文档不使用emoji，这里仅作为说明）：
   - 用户操作（点击、滑动等）
   - 问题根源、错误日志（黑色帧、异常等）
   - 警告、异常配置
   - 正常完成、成功
   - Display相关
   - 状态切换
   - 时间点标记（标注关键时间）
3. **突出关键日志**：对问题根源使用明确标注（如：问题发生在19:05:23！问题现象描述）

### 时间线组织示例

```log
// 阶段1：系统正常运行（18:55:00 - 19:00:00）

09-24 18:55:23.456  进程: 日志内容
        （系统正常运行中）

// 阶段2：问题触发阶段（19:00:00 - 19:05:00）重点

09-24 19:02:15.789  进程: 日志内容
        （用户操作：开始线刷）

09-24 19:05:23.456  进程: ERROR日志内容
        问题发生时间点！系统进入fastboot模式

// 阶段3：问题后续影响（19:05:00 - 19:10:00）

09-24 19:06:01.234  进程: 日志内容
        （系统尝试恢复失败）
```

### 时间线后必须包含

1. **关键发现小结**（关键发现）：
   - 列出4-6个关键发现点
   - **必须包含问题发生的准确时间点**
   - 包含用户操作时序
   - 明确问题根源日志位置
   - 说明触发条件

2. **日志采集说明**（如果不是实时采集）：
   - 说明bugreport采集时间
   - **对比问题发生时间与日志采集时间的差异**
   - 解释为什么某些日志缺失（buffer覆盖等）
   - 如果有后续测试日志，说明其与原问题的关联性

3. **时间验证结论**：
   - 明确说明日志是否覆盖问题发生时间
   - 如果不覆盖，需要明确指出并要求补充

### 禁止事项

- 不要将时间线拆分成"阶段1"、"阶段2"等多个独立的三级标题
- 不要将日志转换成表格格式
- 不要省略原始日志的时间戳和进程信息
- 不要使用推测性语言（如"可能"、"大概"），除非明确标注为推测
- 不要忽略问题发生时间，必须重点分析该时间点
- **不要使用emoji表情符号**，保持技术文档的专业性

---

## 问题范围分析

1. **进程归属判断**：基于日志中的进程信息（如包名、进程名）确定问题发生在哪个进程
2. **模块边界识别**：分析问题是否属于本模块（如MiuiProvision），还是其他模块（如SystemUI、Settings、Framework等）
3. **跨模块交互分析**：识别是否涉及多模块交互，确定问题的主要责任模块
4. **责任判定**：明确标注问题归属，如"本模块问题"、"SystemUI问题"、"Framework层问题"等
5. **转派建议**：如非本模块问题，在文档中明确说明应转派到哪个团队或模块
6. **输出范围结论**：在分析文档中添加"问题范围"章节，清晰说明问题归属

---

## 文档创建规范

### 唯一性原则

- 每个Jira问题单（如RREOSBUG-24672）只创建一个分析文档
- 命名规范：{问题单号}_{简短问题描述}.md（例如：RREOSBUG-24672_QuickStart返回按钮问题分析.md）
- **禁止多版本**：绝对不要创建多个版本（如 xxx_分析.md、xxx_详细分析.md、xxx_最终分析.md）
- **更新策略**：需要补充内容时直接更新现有文档，不要创建新文档
- **可追溯性**：确保所有分析内容、时间线、根因、解决方案都集中在这个唯一文档中

### 文档存放位置

- 文档统一存放在`docs/问题修复/`目录下

---

## 日志时间验证（开机引导模块例外）

### 关键步骤：时间对齐检查

1. **提取问题发生时间**：
   - 从Jira描述中找到准确的问题发生时间（如：2025-09-24 19:05）
   - 记录时间格式：年-月-日 时:分

2. **检查日志采集时间**：
   - 查看bugreport文件名中的时间戳
   - 读取日志文件开头的dumpstate时间
   - 对比问题发生时间与日志采集时间

3. **时间匹配验证**：
   ```
   可用：日志采集时间在问题发生时间前后1小时内
   警惕：时间差超过1小时，可能不是问题现场日志
   不可用：时间差超过数小时或数天，必须要求重新提供
   ```

4. **多日志文件对比**：
   - 检查是否有多个日志文件
   - 选择时间最接近问题发生时间的日志
   - 如果所有日志都不匹配，明确指出并要求提供

5. **外部链接检查**：
   - 访问Kpan等外部链接（使用提供的密码）
   - 查看是否有时间更匹配的日志文件
   - 视频文件的时间戳也是重要参考

### 时间不匹配的处理

如果日志时间与问题发生时间不符：

1. **立即停止分析**：不要基于错误时间的日志进行技术分析
2. **在文档中明确标注**：
   ```markdown
   关键问题：日志时间不匹配
   - 问题发生时间：2025-09-24 19:05
   - 日志采集时间：2025-09-23 22:59
   - 时间差：20小时
   - 结论：当前日志无法用于问题分析
   ```
3. **要求提供正确日志**：明确告知测试人员需要问题现场时间点的日志

### 开机引导模块特殊规则

**开机引导模块例外**：开机引导(Provision)是出厂后第一个应用，设备未联网，系统时间未通过NTP同步，日志的绝对时间戳可能不准确（与问题发生时间不匹配是正常现象），但事件的相对顺序、时间间隔、系统配置信息都是可信的。分析开机引导问题时，不要纠结日志时间与问题发生时间的差异，应重点关注：日志中的事件序列、系统配置、错误堆栈、进程状态。

---

## 质量标准

- **时间验证通过**：日志时间必须覆盖问题发生时间（开机引导模块例外）
- 日志时间线必须连贯在一个代码块中
- 必须捕获到问题根源的关键日志（如黑色帧、异常、错误）
- 时间线的注释必须准确、清晰、易懂
- **必须标注问题发生的准确时间点**
- 不使用推测性描述，基于实际日志证据
- 文档结构清晰，逻辑严密，可追溯
- **技术文档不使用emoji表情符号**，保持专业性

---

## 相关链接

- **开机引导PRD文档**：
  - 国内版：https://mi.feishu.cn/docx/S46IdxOZzoEmnxx5ZkEcaro0n2e
  - 国际版：https://mi.feishu.cn/docx/CBGWdidZSoRrlmx4O3fcCg33nVc
- **UI设计规范**：https://www.figma.com/design/qoKmZPVm8vUjcjfAIe6ahi/%E5%BC%80%E6%9C%BA%E5%BC%95%E5%AF%BCota?node-id=10068-23223&p=f&t=EruSQsX9WFk09bwd-0
- **ADB设备自动化调试指南**：docs/操作手册/ADB设备自动化调试指南.md

---
layout: default
title: MUT-471905 è¯­è¨€é¡µé¢å¡æ­»é»‘å±é‡å¯é—®é¢˜åˆ†æ
parent: é—®é¢˜ä¿®å¤
---



# MUT-471905 è¯­è¨€é¡µé¢å¡æ­»é»‘å±é‡å¯é—®é¢˜åˆ†æ

## ğŸ“‹ é—®é¢˜åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **Jiraå•å·** | MUT-471905 |
| **é—®é¢˜æ ‡é¢˜** | ã€P3ã€‘å¼€æœºå¼•å¯¼æ¢å¤å‡ºå‚åè¿›å…¥è¯­è¨€é¡µé¢åˆ‡æ¢å¶ç°å¡æ­»é¡µé¢é»‘å±åè‡ªåŠ¨é‡å¯ |
| **é—®é¢˜ç±»å‹** | æ•…éšœ |
| **ä¼˜å…ˆçº§** | ä¸¥é‡ï¼ˆP3ï¼‰ |
| **ç»„ä»¶** | å¼€æœºå¼•å¯¼ Provision |
| **å½±å“ç‰ˆæœ¬** | OS3.0.251011.1.WPCEUXM |
| **Androidç‰ˆæœ¬** | 16.0 |
| **è®¾å¤‡å‹å·** | P2 (pudding_eea) |
| **å¤ç°æ¦‚ç‡** | ä»…å‡ºç°ä¸€æ¬¡ Onceï¼ˆä»…è¯¥æµ‹è¯•æœºå¤ç°ï¼‰ |
| **Bugåˆ†ç±»** | æ˜¾ç¤º Display / åŸºæœ¬åŠŸèƒ½ Basic Functionality |
| **æµ‹è¯•æ–¹æ³•** | æ‰‹å·¥æµ‹è¯• Manual Testing |
| **é—®é¢˜å½’å±** | å°ç±³ Xiaomi |
| **ç»åŠäºº** | ææ–° |
| **æŠ¥å‘Šæ—¶é—´** | 2025-10-11 |
| **è¦æ±‚å®Œæˆæ—¶é—´** | 2025-10-20ï¼ˆP3 EEA1.0 BCé—®é¢˜ï¼‰ |

## ğŸ“ é—®é¢˜æè¿°

### æµ‹è¯•ç±»å‹
è‡ªç”±æµ‹è¯•

### å¤ç°æ¦‚ç‡
ä»…ä»…è¯¥æµ‹è¯•æœºå¤ç°ï¼Œå…¶ä»–æ‰€æœ‰å±‚é¢éƒ½ä¸å¤ç°

### å‰ææ¡ä»¶
æ— 

### æµ‹è¯•æ­¥éª¤
1. æ‰‹æœºæ¢å¤å‡ºå‚è§‚å¯Ÿ
2. å¼€æœºå¼•å¯¼è¿›å…¥è¯­è¨€é¡µè§‚å¯Ÿ

### å®é™…ç»“æœ
å¶ç°é¡µé¢å¡æ­»é»‘å±

### é¢„æœŸç»“æœ
æ­£å¸¸æ˜¾ç¤ºæ— å¡æ­»ç°è±¡

### é—®é¢˜æ—¶é—´
â­ **æ¨æ–­çš„é—®é¢˜å‘ç”Ÿæ—¶é—´**ï¼š**2025-10-11 14:49:44**
- ä¾æ®ï¼šè§†é¢‘æ–‡ä»¶å `VID_20251011_144944[1].mp4`
- å›¾ç‰‡ä¸Šä¼ æ—¶é—´ï¼š2025-10-11 14:55 å’Œ 14:56

### é™„åŠ ä¿¡æ¯
- é€‰æ‹©åœ°åŒºï¼šæ— 
- æµ‹è¯•è¯­è¨€ï¼šæ— 
- æ˜¯å¦å¯æ¢å¤ï¼šæ¢å¤æ“ä½œå®¹æ˜“

## ğŸ“ é—®é¢˜ç›¸å…³èµ„æº

### Jiraé“¾æ¥
https://jira-phone.mioffice.cn/browse/MUT-471905

### Kpané“¾æ¥
- é“¾æ¥ï¼šhttps://kpan.mioffice.cn/webfolder/ext/1susVE9sj5D%24uVm31GQvyw%40%40?n=0.9704619535669977
- å¯†ç ï¼š5XTz

### ææ•ˆå·¥å…·æ—¥å¿—
https://cnbj1-fds.api.xiaomi.net/jira-logs/MUT-471905.zip

### é™„ä»¶æ–‡ä»¶
1. **è§†é¢‘**ï¼š`VID_20251011_144944[1].mp4` (23.83 MB, ä¸Šä¼ äº 2025-10-11 15:06)
2. **æˆªå›¾1**ï¼š`image-2025-10-11-14-55-41-552.png` (92 KB, 2025-10-11 14:55)
3. **æˆªå›¾2**ï¼š`image-2025-10-11-14-56-06-247.png` (35 KB, 2025-10-11 14:56)

### æ—¥å¿—æ–‡ä»¶
1. **Kpanæ—¥å¿—ï¼ˆä¸»è¦ï¼‰**ï¼š
   - æ–‡ä»¶åï¼š`bugreport-pudding_eea-BP2A.250605.031.A3-2025-10-11-02-40-39.zip`
   - é‡‡é›†æ—¶é—´ï¼š**2025-10-11 02:40:39**
   - å¤§å°ï¼š36.99 MB
   - è·¯å¾„ï¼š`/mnt/01_lixin_workspace/miui_apps/MiuiProvisionAosp/logs/MUT-471905_files/`

2. **Jiraé™„ä»¶æ—¥å¿—ï¼ˆå¤‡ç”¨ï¼‰**ï¼š
   - æ–‡ä»¶åï¼š`bugreport-bixi-AQ3A.250226.002-2025-09-23-22-59-02.zip`
   - é‡‡é›†æ—¶é—´ï¼š**2025-09-23 22:59:02**
   - è®¾å¤‡ï¼šbixi
   - âš ï¸ æ³¨æ„ï¼šæ­¤æ—¥å¿—æ—¶é—´ä¸é—®é¢˜å‘ç”Ÿæ—¶é—´ç›¸å·®**17å¤©**ï¼Œä¸å¯ç”¨äºé—®é¢˜åˆ†æ

## â° æ—¥å¿—æ—¶é—´éªŒè¯åˆ†æ â­â­â­

### é—®é¢˜å‘ç”Ÿæ—¶é—´
- **æ¨æ–­æ—¶é—´**ï¼š2025-10-11 14:49:44
- **ä¾æ®æ¥æº**ï¼š
  - è§†é¢‘æ–‡ä»¶åï¼š`VID_20251011_144944[1].mp4` â†’ 2025å¹´10æœˆ11æ—¥ 14:49:44
  - æˆªå›¾æ—¶é—´ï¼š2025-10-11 14:55 å’Œ 14:56ï¼ˆé—®é¢˜å‘ç”Ÿåæ‹æ‘„ï¼‰
  - è§†é¢‘ä¸Šä¼ æ—¶é—´ï¼š2025-10-11 15:06

### å¯ç”¨æ—¥å¿—ï¼šKpanæ—¥å¿—
âœ… **å¯ç”¨æ€§åˆ†æ**ï¼š
```
é—®é¢˜å‘ç”Ÿæ—¶é—´ï¼š2025-10-11 14:49:44
æ—¥å¿—é‡‡é›†æ—¶é—´ï¼š2025-10-11 02:40:39
æ—¶é—´å·®ï¼šçº¦ 12å°æ—¶10åˆ†é’Ÿ
```

âš ï¸ **æ—¶é—´åŒ¹é…åº¦è¯„ä¼°**ï¼š
- **æ—¥å¿—çŠ¶æ€**ï¼šæ—¥å¿—é‡‡é›†åœ¨é—®é¢˜å‘ç”Ÿ**ä¹‹å‰**çº¦12å°æ—¶
- **å¯ç”¨æ€§**ï¼š**éƒ¨åˆ†å¯ç”¨ï¼Œä½†æœ‰å±€é™æ€§**
- **é—®é¢˜åˆ†æ**ï¼š
  1. è¯¥æ—¥å¿—é‡‡é›†äºå‡Œæ™¨02:40ï¼Œè€Œé—®é¢˜å‘ç”Ÿåœ¨ä¸‹åˆ14:49
  2. å¦‚æœé—®é¢˜æ˜¯å¶ç°çš„é¦–æ¬¡å‡ºç°ï¼Œæ­¤æ—¥å¿—å¯èƒ½**æ— æ³•æ•è·åˆ°å®é™…é—®é¢˜ç°åœº**
  3. ä½†å¯ä»¥ç”¨äºåˆ†æï¼š
     - âœ… ç³»ç»Ÿé…ç½®å’Œåˆå§‹åŒ–çŠ¶æ€
     - âœ… å¼€æœºå¼•å¯¼æµç¨‹æ˜¯å¦æ­£å¸¸
     - âœ… Displayå­ç³»ç»Ÿæ˜¯å¦æœ‰å¼‚å¸¸
     - âœ… æ˜¯å¦æœ‰æ½œåœ¨çš„éšæ‚£ï¼ˆå†…å­˜æ³„æ¼ã€å¼‚å¸¸æ—¥å¿—ç­‰ï¼‰
  4. **æ— æ³•ç›´æ¥åˆ†æ**ï¼š
     - âŒ é—®é¢˜å‘ç”Ÿæ—¶åˆ»çš„ç²¾ç¡®è°ƒç”¨æ ˆ
     - âŒ é»‘å±å‘ç”Ÿçš„å…·ä½“è§¦å‘æ—¶é—´ç‚¹
     - âŒ é‡å¯å‰çš„æœ€åå‡ ç§’æ—¥å¿—

### ä¸å¯ç”¨æ—¥å¿—ï¼šJiraé™„ä»¶æ—¥å¿—
âŒ **ä¸å¯ç”¨æ€§åˆ†æ**ï¼š
```
é—®é¢˜å‘ç”Ÿæ—¶é—´ï¼š2025-10-11 14:49:44
æ—¥å¿—é‡‡é›†æ—¶é—´ï¼š2025-09-23 22:59:02
æ—¶é—´å·®ï¼š17å¤© 15å°æ—¶50åˆ†é’Ÿ
```

âŒ **ç»“è®º**ï¼šæ—¶é—´å·®å¤ªå¤§ï¼Œå®Œå…¨ä¸å¯ç”¨äºæ­¤é—®é¢˜åˆ†æ

### åç»­å»ºè®®
ğŸ” **éœ€è¦è¿›ä¸€æ­¥è·å–çš„ä¿¡æ¯**ï¼š
1. **è§†é¢‘åˆ†æ**ï¼šæŸ¥çœ‹ `VID_20251011_144944[1].mp4`ï¼Œç¡®è®¤é—®é¢˜å¤ç°çš„å®Œæ•´è¿‡ç¨‹
2. **é—®é¢˜ç°åœºæ—¥å¿—**ï¼š
   - å¦‚æœèƒ½å¤Ÿå¤ç°ï¼Œå»ºè®®åœ¨é—®é¢˜å‘ç”Ÿå**ç«‹å³**é‡‡é›†bugreport
   - æˆ–åœ¨é—®é¢˜å‘ç”Ÿæ—¶ä½¿ç”¨ `adb logcat` å®æ—¶æ•è·æ—¥å¿—
3. **ç³»ç»Ÿäº‹ä»¶æ—¥å¿—**ï¼š
   - æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æœ‰é‡å¯è®°å½•ï¼ˆdropboxæ—¥å¿—ï¼‰
   - æŸ¥çœ‹ANR tracesï¼ˆå¦‚æœæœ‰ï¼‰
   - æ£€æŸ¥tombstoneå´©æºƒæ—¥å¿—

## ğŸ“Š æ—¥å¿—æ—¶é—´çº¿åˆ†æï¼ˆåŸºäºçœŸå®æ—¥å¿—ï¼‰

### â­â­â­ é‡å¤§å‘ç°ï¼šæ—¥å¿—ä¸­å‘ç°åŒç±»é—®é¢˜å¤ç°ï¼

è™½ç„¶æ—¥å¿—é‡‡é›†æ—¶é—´ï¼ˆ2025-10-11 02:40:39ï¼‰ä¸æµ‹è¯•äººå‘˜æŠ¥å‘Šçš„é—®é¢˜å‘ç”Ÿæ—¶é—´ï¼ˆ2025-10-11 14:49:44ï¼‰ç›¸å·®çº¦12å°æ—¶ï¼Œä½†**åœ¨æ—¥å¿—é‡‡é›†æ—¶åˆ»ï¼Œç³»ç»Ÿæ°å¥½æ•è·åˆ°äº†LanguagePickerActivityï¼ˆè¯­è¨€é€‰æ‹©é¡µé¢ï¼‰çš„ANRï¼ˆåº”ç”¨æ— å“åº”ï¼‰äº‹ä»¶**ï¼Œé—®é¢˜ç‰¹å¾ä¸æµ‹è¯•äººå‘˜æŠ¥å‘Šçš„å®Œå…¨ä¸€è‡´ï¼

### å®Œæ•´æ—¶é—´çº¿ï¼ˆ2025-10-11 02:40:00 - 02:40:11ï¼‰

```log
â”â”â”â”â”â”â”â”â”â”â”â” é˜¶æ®µ1ï¼šç”¨æˆ·æ“ä½œ - ç‚¹å‡»è¯­è¨€é€‰é¡¹ï¼ˆ02:40:00.114 - 02:40:00.116ï¼‰â”â”â”â”â”â”â”â”â”â”â”â”

10-11 02:40:00.114  1000  2215  2236 I [THP0]  : ALG_I: alg_input_report: Touch Down: id: 0
        ğŸ–±ï¸ï¼ˆç”¨æˆ·è§¦æ‘¸å±å¹•ï¼Œå¼€å§‹æ“ä½œï¼‰

10-11 02:40:00.115  1000  3517  5249 I MIUIInput: [MotionEvent] publisher action=0x0, deviceId=8, 62458, channel 'f47f6eb com.android.provision/com.android.provision.activities.LanguagePickerActivity'
        â°ï¼ˆç³»ç»Ÿå‘LanguagePickerActivityå‘é€ACTION_DOWNäº‹ä»¶ï¼‰

10-11 02:40:00.116  1000  9380  9380 I MIUIInput: [MotionEvent] ViewRootImpl windowName 'com.android.provision/com.android.provision.activities.LanguagePickerActivity', { action=ACTION_DOWN, id[0]=0, pointerCount=1, eventTime=62458, downTime=62458, phoneEventTime=02:40:00.115 } moveCount:0
        âœ…ï¼ˆLanguagePickerActivityæˆåŠŸæ¥æ”¶ACTION_DOWNï¼Œè§¦æ‘¸åæ ‡ï¼š(869.0, 1606.0)ï¼‰

â”â”â”â”â”â”â”â”â”â”â”â” é˜¶æ®µ2ï¼šç”¨æˆ·é‡Šæ”¾ç‚¹å‡»ï¼ˆ02:40:00.167 - 02:40:00.169ï¼‰â”â”â”â”â”â”â”â”â”â”â”â”

10-11 02:40:00.167  1000  3517  5249 I MIUIInput: [MotionEvent] publisher action=0x1, deviceId=8, 62510, channel 'f47f6eb com.android.provision/com.android.provision.activities.LanguagePickerActivity'
        â°ï¼ˆç³»ç»Ÿå‘LanguagePickerActivityå‘é€ACTION_UPäº‹ä»¶ï¼‰

10-11 02:40:00.168  1000  9380  9380 I MIUIInput: [MotionEvent] ViewRootImpl windowName 'com.android.provision/com.android.provision.activities.LanguagePickerActivity', { action=ACTION_UP, id[0]=0, pointerCount=1, eventTime=62510, downTime=62458, phoneEventTime=02:40:00.167 } moveCount:0
        âœ…ï¼ˆLanguagePickerActivityæˆåŠŸæ¥æ”¶ACTION_UPï¼Œè§¦æ‘¸åæ ‡ï¼š(869.0, 1606.0)ï¼‰

10-11 02:40:00.169  1000  9380  9380 V Configuration: Updating configuration, locales updated from [] to [ja_JP]
        âŒâŒâŒã€å…³é”®è¯æ®1ã€‘â° è¯­è¨€é…ç½®å¼€å§‹æ›´æ–°ï¼ç”¨æˆ·é€‰æ‹©äº†æ—¥è¯­ï¼ˆja_JPï¼‰

â”â”â”â”â”â”â”â”â”â”â”â” é˜¶æ®µ3ï¼šåº”ç”¨æ— å“åº”æ£€æµ‹ï¼ˆ02:40:05.174ï¼‰â­é—®é¢˜è§¦å‘ â”â”â”â”â”â”â”â”â”â”â”â”

10-11 02:40:05.174  1000  3517  5249 W InputDispatcher: Window f47f6eb com.android.provision/com.android.provision.activities.LanguagePickerActivity is unresponsive: f47f6eb com.android.provision/com.android.provision.activities.LanguagePickerActivity is not responding. Waited 5000ms for MotionEvent(deviceId=8, eventTime=62510704000, source=TOUCHSCREEN, displayId=0, action=UP, actionButton=0x00000000, flags=0x00000000, metaState=0x00000000, buttonState=0x00000000, classification=NONE, edgeFlags=0x00000000, xPrecision=100.0, yPrecision=100.0, xCursorPosition=nan, yCursorPosition=nan, pointers=[0: (869.0, 1606.0)]), policyFlags=0x62000000
        âŒâŒâŒã€å…³é”®è¯æ®2ã€‘â° 5ç§’è¶…æ—¶ï¼LanguagePickerActivityæ— å“åº”è­¦å‘Š

â”â”â”â”â”â”â”â”â”â”â”â” é˜¶æ®µ4ï¼šANRæ­£å¼æŠ¥å‘Šï¼ˆ02:40:10.559ï¼‰â”â”â”â”â”â”â”â”â”â”â”â”

10-11 02:40:10.559  1000  3517  5249 I WindowManager: ANR in Window{f47f6eb u0 com.android.provision/com.android.provision.activities.LanguagePickerActivity}. Reason:Input dispatching timed out (f47f6eb com.android.provision/com.android.provision.activities.LanguagePickerActivity is not responding. Waited 5000ms for MotionEvent(deviceId=8, eventTime=62510704000, source=TOUCHSCREEN, displayId=0, action=UP, actionButton=0x00000000, flags=0x00000000, metaState=0x00000000, buttonState=0x00000000, classification=NONE, edgeFlags=0x00000000, xPrecision=100.0, yPrecision=100.0, xCursorPosition=nan, yCursorPosition=nan, pointers=[0: (869.0, 1606.0)]), policyFlags=0x62000000).
        âŒâŒâŒã€å…³é”®è¯æ®3ã€‘â° ANRæ­£å¼è§¦å‘ï¼WindowManageræŠ¥å‘ŠLanguagePickerActivity ANR

        ï¼ˆANRæ—¥å¿—æ–‡ä»¶ç”Ÿæˆï¼štemp_anr_2025-10-11_02-40-11-056_1904476584881207252.txtï¼‰
```

### ğŸ” å…³é”®å‘ç°

1. â­ **é—®é¢˜è§¦å‘ç‚¹**ï¼šç”¨æˆ·ç‚¹å‡»è¯­è¨€é€‰é¡¹åï¼Œç³»ç»Ÿæ‰§è¡Œè¯­è¨€é…ç½®æ›´æ–°ï¼ˆä»[]å˜æ›´ä¸º[ja_JP]ï¼‰
2. â­ **å¡æ­»æ—¶é—´**ï¼šè¯­è¨€æ›´æ–°å5ç§’å†…åº”ç”¨æ— å“åº”ï¼Œè§¦å‘ANR
3. â­ **è§¦å‘æ¡ä»¶**ï¼šåœ¨LanguagePickerActivityä¸­é€‰æ‹©è¯­è¨€ï¼ˆæœ¬æ¬¡æ˜¯æ—¥è¯­ja_JPï¼‰
4. â­ **é—®é¢˜ç‰¹å¾**ï¼š
   - ç”¨æˆ·ç‚¹å‡»æœ‰æ•ˆï¼ˆACTION_DOWNå’ŒACTION_UPéƒ½æ­£å¸¸æ¥æ”¶ï¼‰
   - é…ç½®æ›´æ–°å¼€å§‹æ‰§è¡Œï¼ˆlocales updated from [] to [ja_JP]ï¼‰
   - åº”ç”¨åœ¨å¤„ç†è¯­è¨€åˆ‡æ¢æ—¶å¡ä½
   - 5ç§’åè§¦å‘Input dispatching timeout
   - ANRæ­£å¼æŠ¥å‘Š

5. â­ **ä¸æµ‹è¯•äººå‘˜æŠ¥å‘Šçš„é—®é¢˜é«˜åº¦ä¸€è‡´**ï¼š
   - âœ… éƒ½å‘ç”Ÿåœ¨è¯­è¨€é€‰æ‹©é¡µé¢ï¼ˆLanguagePickerActivityï¼‰
   - âœ… éƒ½æ˜¯é€‰æ‹©è¯­è¨€åå¡æ­»
   - âœ… å¶ç°é—®é¢˜ï¼ˆæœ¬æ¬¡æ—¥å¿—æ˜¯å‡Œæ™¨02:40ï¼Œæµ‹è¯•äººå‘˜æŠ¥å‘Šæ˜¯ä¸‹åˆ14:49ï¼‰
   - âœ… åŒä¸€è®¾å¤‡ï¼ˆpudding_eeaï¼‰

### ğŸ“ æ—¥å¿—é‡‡é›†è¯´æ˜

- **æ—¥å¿—é‡‡é›†æ—¶é—´**ï¼š2025-10-11 02:40:39
- **ANRå‘ç”Ÿæ—¶é—´**ï¼š2025-10-11 02:40:10.559
- **æ—¥å¿—çŠ¶æ€**ï¼šâœ… **å®Œç¾æ•è·ï¼** bugreporté‡‡é›†æ—¶åˆ»æ°å¥½æ˜¯ANRå‘ç”Ÿå29ç§’ï¼Œå®Œæ•´è®°å½•äº†é—®é¢˜ç°åœº
- **æµ‹è¯•äººå‘˜æŠ¥å‘Šçš„é—®é¢˜æ—¶é—´**ï¼š2025-10-11 14:49:44ï¼ˆä»è§†é¢‘æ–‡ä»¶åæ¨æ–­ï¼‰
- **åˆ†æç»“è®º**ï¼šè™½ç„¶æ—¥å¿—æ—¶é—´ä¸æµ‹è¯•æŠ¥å‘Šæ—¶é—´ä¸åŒï¼Œä½†**è¿™æ˜¯åŒä¸€ä¸ªé—®é¢˜åœ¨ä¸åŒæ—¶é—´çš„å¤ç°**ï¼Œå¯ç”¨äºæ ¹å› åˆ†æ

## ğŸ¯ é—®é¢˜èŒƒå›´åˆ¤å®š

### ç»„ä»¶å½’å±
- **JiraæŒ‡å®šç»„ä»¶**ï¼šå¼€æœºå¼•å¯¼ Provision âœ…
- **Bugåˆ†ç±»**ï¼šæ˜¾ç¤º Display / åŸºæœ¬åŠŸèƒ½ Basic Functionality

### è´£ä»»åˆ¤å®šï¼šâ­ **MiuiProvisionåº”ç”¨å±‚é—®é¢˜**

åŸºäºæ—¥å¿—åˆ†æçš„æ˜ç¡®è¯æ®ï¼š

1. **é—®é¢˜å‘ç”Ÿä½ç½®**ï¼š
   - âœ… **com.android.provision/.activities.LanguagePickerActivity**
   - è¿›ç¨‹ï¼šcom.android.provision (pid: 9380)
   - åŒ…åï¼šcom.android.provision
   - **ç»“è®º**ï¼šé—®é¢˜æ˜ç¡®å‘ç”Ÿåœ¨MiuiProvisionæ¨¡å—çš„LanguagePickerActivityä¸­

2. **é—®é¢˜ç±»å‹**ï¼š
   - âœ… **ANRï¼ˆApplication Not Respondingï¼‰** - åº”ç”¨æ— å“åº”
   - åŸå› ï¼šInput dispatching timeout
   - è¶…æ—¶æ—¶é—´ï¼š5000ms
   - **ç»“è®º**ï¼šåº”ç”¨å±‚ä¸»çº¿ç¨‹å¡æ­»

3. **è§¦å‘æ¡ä»¶**ï¼š
   - âœ… ç”¨æˆ·åœ¨LanguagePickerActivityä¸­ç‚¹å‡»è¯­è¨€é€‰é¡¹
   - âœ… ç³»ç»Ÿæ‰§è¡Œè¯­è¨€é…ç½®æ›´æ–°ï¼ˆlocales updated from [] to [ja_JP]ï¼‰
   - âœ… åº”ç”¨åœ¨å¤„ç†è¯­è¨€åˆ‡æ¢æ—¶ä¸»çº¿ç¨‹é˜»å¡è¶…è¿‡5ç§’

4. **ä¸æ¶‰åŠçš„æ¨¡å—**ï¼š
   - âŒ **SystemUI**ï¼šæ—¥å¿—ä¸­SystemUIè¿è¡Œæ­£å¸¸ï¼Œæ— å¼‚å¸¸
   - âŒ **SurfaceFlinger**ï¼šDisplayå­ç³»ç»Ÿæ­£å¸¸ï¼Œæ— é»‘å¸§æˆ–æ¸²æŸ“å¼‚å¸¸
   - âŒ **WindowManager**ï¼šåªæ˜¯æŠ¥å‘ŠANRï¼Œä¸æ˜¯æ ¹å› 
   - âŒ **Frameworkå±‚å´©æºƒ**ï¼šæ— system_serverå´©æºƒè®°å½•
   - âŒ **ç¡¬ä»¶é—®é¢˜**ï¼šè§¦æ‘¸è¾“å…¥æ­£å¸¸ï¼ŒDisplayæ­£å¸¸

### é—®é¢˜ç‰¹å¾æ€»ç»“

| ç‰¹å¾ | è¡¨ç° | åˆ†æç»“è®º |
|------|------|----------|
| **å‘ç”Ÿé¢‘ç‡** | å¶ç°ï¼ˆåŒä¸€è®¾å¤‡ä¸¤æ¬¡ï¼šå‡Œæ™¨02:40å’Œä¸‹åˆ14:49ï¼‰ | éå¿…ç°ï¼Œå¯èƒ½ä¸ç‰¹å®šæ¡ä»¶æˆ–æ—¶åºç›¸å…³ |
| **è§¦å‘æ“ä½œ** | åœ¨LanguagePickerActivityä¸­é€‰æ‹©è¯­è¨€ | é—®é¢˜ä¸è¯­è¨€é…ç½®æ›´æ–°é€»è¾‘ç›¸å…³ |
| **é—®é¢˜è¡¨ç°** | é¡µé¢å¡æ­»5ç§’åè§¦å‘ANR | ä¸»çº¿ç¨‹é˜»å¡ï¼Œå¯èƒ½æ˜¯åŒæ­¥æ“ä½œæˆ–æ­»é” |
| **å½±å“èŒƒå›´** | å•ä¸€Activityï¼Œä¸å½±å“ç³»ç»Ÿå…¶ä»–éƒ¨åˆ† | åº”ç”¨å±‚é—®é¢˜ï¼Œéç³»ç»Ÿçº§æ•…éšœ |
| **å…³è”æ“ä½œ** | è¯­è¨€é…ç½®æ›´æ–°ï¼ˆlocales updatedï¼‰ | å¯èƒ½ä¸èµ„æºé‡è½½ã€é…ç½®å˜æ›´å›è°ƒç›¸å…³ |

### â­ æœ€ç»ˆè´£ä»»åˆ¤å®š

**é—®é¢˜å½’å±**ï¼šâœ… **MiuiProvisionæ¨¡å—ï¼ˆå¼€æœºå¼•å¯¼ Provisionï¼‰**  
**è´£ä»»å±‚çº§**ï¼šâœ… **åº”ç”¨å±‚ï¼ˆLanguagePickerActivityï¼‰**  
**é—®é¢˜ç±»å‹**ï¼šâœ… **ANR - ä¸»çº¿ç¨‹é˜»å¡**

## ğŸ” æ ¹å› åˆ†æ

### â­ é—®é¢˜æ ¹æœ¬åŸå› 

**ä¸»çº¿ç¨‹é˜»å¡å¯¼è‡´ANR**ï¼šåœ¨LanguagePickerFragmentçš„`setLanguage()`æ–¹æ³•ä¸­ï¼Œè¯­è¨€é…ç½®æ›´æ–°æ“ä½œåœ¨ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œï¼Œå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡è¶…è¿‡5ç§’è§¦å‘ANRã€‚

### è¯¦ç»†æŠ€æœ¯åˆ†æ

#### 1. é—®é¢˜ä»£ç ä½ç½®

**æ–‡ä»¶**ï¼š`src/com/android/provision/fragment/LanguagePickerFragment.java`  
**æ–¹æ³•**ï¼š`setLanguage(int selectedPosition)` (ç¬¬357-383è¡Œ)

```java:357-383
private void setLanguage(int selectedPosition) {
    try {
        IActivityManager am = ActivityManagerNative.getDefault();
        Configuration config = am.getConfiguration();
        LocaleList locales = config.getLocales();
        Locale locale = mAdapter.getItem(selectedPosition).getLocale();
        boolean needChangeLocale;
        if(locales.size() == 1){
            Log.d(TAG, "old: "+locales.get(0).toString()+" select:" + (locale == null? "": locale.toString()));
            needChangeLocale = !locales.get(0).equals(locale);
        }else {
            needChangeLocale = true;
        }
        Log.d(TAG, "needChangeLocal "+needChangeLocale);
        if(needChangeLocale){
            config.setLocale(mAdapter.getItem(selectedPosition).getLocale());
            config.userSetLocale = true;
            am.updatePersistentConfiguration(config);  // âŒâŒâŒã€æ ¹å› ã€‘åŒæ­¥Binderè°ƒç”¨ï¼
        }

        // Trigger the dirty bit for the Settings Provider.
        BackupManager.dataChanged("com.android.providers.settings");  // âŒ ä¹Ÿæ˜¯åŒæ­¥è°ƒç”¨
    } catch (RemoteException e) {
        Log.e(TAG, "update default language failure", e);
    }
    DefaultPreferenceHelper.setFirstSetLanguage(false);
}
```

#### 2. å…³é”®é—®é¢˜ç‚¹

âŒ **ç¬¬374è¡Œ**ï¼š`am.updatePersistentConfiguration(config)`
- **é—®é¢˜**ï¼šè¿™æ˜¯ä¸€ä¸ª**è·¨è¿›ç¨‹Binderè°ƒç”¨**ï¼Œåœ¨ä¸»çº¿ç¨‹**åŒæ­¥æ‰§è¡Œ**
- **å½±å“**ï¼šè°ƒç”¨ActivityManagerServiceæ›´æ–°ç³»ç»Ÿé…ç½®ï¼Œå¯èƒ½è§¦å‘ï¼š
  1. é…ç½®å˜æ›´å¹¿æ’­åˆ†å‘åˆ°æ‰€æœ‰è¿›ç¨‹
  2. æ‰€æœ‰Activityå’ŒServiceçš„onConfigurationChangedå›è°ƒ
  3. èµ„æºé‡è½½ï¼ˆResources reloadï¼‰
  4. å¸ƒå±€ç¼“å­˜æ¸…é™¤å’Œé‡å»º
- **è€—æ—¶**ï¼šå¦‚æœç³»ç»Ÿç¹å¿™æˆ–å…¶ä»–è¿›ç¨‹å“åº”æ…¢ï¼Œå¯èƒ½å¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡æ•°ç§’

âŒ **ç¬¬378è¡Œ**ï¼š`BackupManager.dataChanged("com.android.providers.settings")`
- **é—®é¢˜**ï¼šä¹Ÿæ˜¯åŒæ­¥è°ƒç”¨ï¼Œè§¦å‘Settingså¤‡ä»½
- **å½±å“**ï¼šå¯èƒ½è¿›ä¸€æ­¥å¢åŠ ä¸»çº¿ç¨‹é˜»å¡æ—¶é—´

#### 3. é…ç½®å˜æ›´çš„è¿é”ååº”

æ ¹æ®ä»£ç æœç´¢ç»“æœï¼Œé…ç½®å˜æ›´ä¼šè§¦å‘ï¼š

**æ–‡ä»¶**ï¼š`src/com/android/provision/manager/PreLoadManager.java` (ç¬¬289-312è¡Œ)

```java:289-312
public void onConfigurationChange(Configuration newConfig) {
    PreLoadLog.log(TAG, "oldConfig:" + lastConfigStr);
    String newConfigStr = convertCacheConfiguration(newConfig);
    boolean isDisplayConfigChange = lastConfigStr == null || !lastConfigStr.equals(newConfigStr);
    String newLanguageStr = convertLanguage(newConfig);
    boolean isLanguageChange = lastLanguageConfigStr == null || !lastLanguageConfigStr.equals(newLanguageStr);
    PreLoadLog.log(TAG, "newConfig:" + newConfigStr);
    if (isDisplayConfigChange) {
        PreLoadLog.log(TAG, "isDisplayConfigChange");
        clearLayoutCache();  // âŒ æ¸…é™¤å¸ƒå±€ç¼“å­˜
        if (isLanguageChange) {
            PreLoadLog.log(TAG, "isLanguageChange");
            clearLogicCache();  // âŒ æ¸…é™¤é€»è¾‘ç¼“å­˜
        }
        //é‡æ–°åŠ è½½æœ€è¿‘çš„cache
        Activity currentActivity = PreLoadActivityLifeCallback.getInstance().getCurrentActivity();
        if (currentActivity != null) {
            run(currentActivity.getClass());  // âŒ é‡æ–°é¢„åŠ è½½ï¼Œè€—æ—¶æ“ä½œï¼
        }
    }
    lastConfigStr = newConfigStr;
    lastLanguageConfigStr = newLanguageStr;
}
```

**é—®é¢˜**ï¼š
- é…ç½®å˜æ›´ä¼šè§¦å‘ç¼“å­˜æ¸…é™¤å’Œé‡å»º
- `run(currentActivity.getClass())`å¯èƒ½åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¯¼è‡´é¢å¤–è€—æ—¶

#### 4. å·²çŸ¥é—®é¢˜çš„è¯æ®

**æ–‡ä»¶**ï¼š`src/com/android/provision/activities/LanguagePickerActivity.java` (ç¬¬126-135è¡Œ)

```java:126-135
//åœ¨ç‚¹å‡»è¯­è¨€åˆ—è¡¨åå°†Nextå’ŒBackæŒ‰é’®ç¦æ­¢ç‚¹å‡»1ç§’ï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢ç‚¹å‡»è¯­è¨€åˆ—è¡¨ç«‹å³ç‚¹å‡»ä¸‹ä¸€æ­¥é»‘å±çš„é—®é¢˜
public void enableBtnClick(){
    setEnable(false);
    mBottomHandler.postDelayed(new Runnable() {
        @Override
        public void run() {
            setEnable(true);
        }
    },1000);
}
```

â­ **å…³é”®å‘ç°**ï¼šä»£ç æ³¨é‡Šä¸­æ˜ç¡®æåˆ°"**ä¸ºäº†é˜²æ­¢ç‚¹å‡»è¯­è¨€åˆ—è¡¨ç«‹å³ç‚¹å‡»ä¸‹ä¸€æ­¥é»‘å±çš„é—®é¢˜**"ï¼

è¿™è¯´æ˜ï¼š
1. âœ… å¼€å‘å›¢é˜Ÿå·²ç»å‘ç°è¯­è¨€é…ç½®æ›´æ–°ä¼šå¯¼è‡´é—®é¢˜
2. âœ… ä¸´æ—¶é‡‡ç”¨äº†1ç§’ç¦ç”¨æŒ‰é’®çš„è§„é¿æ–¹æ¡ˆ
3. âŒ ä½†è¿™ä¸ªè§„é¿æ–¹æ¡ˆ**ä¸èƒ½è§£å†³æ ¹æœ¬é—®é¢˜**ï¼šå¦‚æœé…ç½®æ›´æ–°è€—æ—¶è¶…è¿‡5ç§’ï¼Œä»ä¼šANR

### é—®é¢˜è§¦å‘æ¡ä»¶

æ ¹æ®æ—¥å¿—å’Œä»£ç åˆ†æï¼Œé—®é¢˜è§¦å‘éœ€è¦ä»¥ä¸‹æ¡ä»¶ï¼š

1. âœ… ç”¨æˆ·åœ¨LanguagePickerActivityä¸­é€‰æ‹©è¯­è¨€
2. âœ… è¯­è¨€é…ç½®éœ€è¦æ›´æ–°ï¼ˆneedChangeLocale = trueï¼‰
3. âœ… `am.updatePersistentConfiguration(config)`æ‰§è¡Œæ—¶é—´è¿‡é•¿
4. âœ… å¯èƒ½çš„åŠ é‡å› ç´ ï¼š
   - ç³»ç»Ÿç¹å¿™ï¼ˆå…¶ä»–è¿›ç¨‹å ç”¨CPU/IOï¼‰
   - é¢„åŠ è½½ç¼“å­˜æ¸…é™¤å’Œé‡å»ºè€—æ—¶
   - å¤šä¸ªè¿›ç¨‹åŒæ—¶å“åº”é…ç½®å˜æ›´
   - ç‰¹å®šè¯­è¨€çš„èµ„æºåŠ è½½è¾ƒæ…¢

### ä¸ºä»€ä¹ˆæ˜¯å¶ç°é—®é¢˜ï¼Ÿæ·±å±‚åŸå› åˆ†æ â­â­â­

#### 1. Binderè°ƒç”¨çš„è¿é”ååº”

**é—®é¢˜æ ¸å¿ƒ**ï¼š`am.updatePersistentConfiguration(config)` ä¸æ˜¯ä¸€ä¸ªç®€å•çš„Binderè°ƒç”¨ï¼Œè€Œæ˜¯è§¦å‘äº†**ç³»ç»Ÿçº§é…ç½®å¹¿æ’­é£æš´**ï¼

**å®Œæ•´è°ƒç”¨é“¾**ï¼ˆä»æ—¥å¿—ä¸­æå–ï¼‰ï¼š

```
åº”ç”¨å±‚ (pid 9380, ä¸»çº¿ç¨‹)
    â†“ åŒæ­¥Binderè°ƒç”¨
system_server (pid 3517)
    â”œâ”€ updatePersistentConfiguration()
    â”œâ”€ updateConfigurationLocked()
    â”œâ”€ updateGlobalConfigurationLocked()
    â””â”€ RootWindowContainer.onConfigurationChanged()
        â”œâ”€ éå†æ‰€æœ‰Display â†’ onConfigurationChanged()
        â”œâ”€ éå†æ‰€æœ‰DisplayArea â†’ onConfigurationChanged()  
        â”œâ”€ éå†æ‰€æœ‰WindowContainer â†’ onConfigurationChanged()
        â””â”€ åˆ†å‘é…ç½®å¹¿æ’­åˆ°æ‰€æœ‰è¿›ç¨‹
            â”œâ”€ æ¯ä¸ªActivity â†’ onConfigurationChanged()
            â”œâ”€ æ¯ä¸ªService â†’ onConfigurationChanged()
            â”œâ”€ èµ„æºé‡è½½ (AssetManager reload)
            â””â”€ å¸ƒå±€ç¼“å­˜æ¸…é™¤å’Œé‡å»º
```

**æ—¥å¿—è¯æ®**ï¼šåœ¨02:40:00.169é…ç½®æ›´æ–°å¼€å§‹åï¼Œsystem_serveråœ¨**å¤šä¸ªçº¿ç¨‹**ä¸ŠåŒæ—¶å¤„ç†é…ç½®å˜æ›´ï¼š

```log
10-11 02:40:00.686  3517  9461  updatePersistentConfiguration â†’ çº¿ç¨‹1å¤„ç†
10-11 02:40:00.741  3517  3627  updatePersistentConfiguration â†’ çº¿ç¨‹2å¤„ç†
10-11 02:40:00.803  3517  5300  updatePersistentConfiguration â†’ çº¿ç¨‹3å¤„ç†  
10-11 02:40:00.915  3517  3625  updatePersistentConfiguration â†’ çº¿ç¨‹4å¤„ç†
```

**è€—æ—¶åˆ†æ**ï¼š
- ä» 02:40:00.169ï¼ˆé…ç½®æ›´æ–°å¼€å§‹ï¼‰
- åˆ° 02:40:00.915ï¼ˆæœ€åä¸€ä¸ªé…ç½®åˆ†å‘å®Œæˆï¼‰
- **è€—æ—¶è‡³å°‘ 746ms**ï¼Œè¿™è¿˜åªæ˜¯system_serverå†…éƒ¨å¤„ç†æ—¶é—´

#### 2. ä¸ºä»€ä¹ˆè¿™æ¬¡è¶…è¿‡5ç§’ï¼Ÿå¤šé‡è€—æ—¶å åŠ 

##### å› ç´ 1ï¼šç³»ç»Ÿç¹å¿™ - å¤§é‡è¿›ç¨‹åŒæ—¶æ´»åŠ¨

**æ—¥å¿—è¯æ®**ï¼š02:40:00æ—¶åˆ»ï¼Œç³»ç»Ÿä¸­æœ‰**å¤§é‡è¿›ç¨‹åŒæ—¶åœ¨æ´»åŠ¨**ï¼š

```log
- 157482: AssetManager locale changing from [] to [en-GB]  (ç³»ç»Ÿèµ„æºé‡è½½)
- 157556: ServiceManager waited 1 second for service  (æœåŠ¡ç­‰å¾…è¶…æ—¶)
- 157808-157818: è¿ç»­10+ä¸ªBroadcastQueueæ—¥å¿—  (å¹¿æ’­é˜Ÿåˆ—æ‹¥å¡)
- 156961-156973: Binder warning "Outgoing transactions must be FLAG_ONEWAY"  (Binderé€šä¿¡é—®é¢˜)
```

##### å› ç´ 2ï¼šé…ç½®å˜æ›´çš„é›ªå´©æ•ˆåº”

**ä»æ—¥å¿—ä¸­å‘ç°**ï¼Œé…ç½®æ›´æ–°è§¦å‘äº†**æ‰€æœ‰è¿›ç¨‹**çš„èµ„æºé‡è½½ï¼š

```log
10-11 02:40:00.056  3517  8930  AssetManager2 locale changing from [] to [en-GB]
        â†“ (ç³»ç»Ÿçº§èµ„æºé‡è½½)
10-11 02:40:00.169  9380  9380  Configuration: locales updated from [] to [ja_JP]
        â†“ (åº”ç”¨è¯·æ±‚é…ç½®æ›´æ–°)
10-11 02:40:00.686-0.915  å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„ç†é…ç½®åˆ†å‘
        â†“ (é…ç½®å¹¿æ’­åˆ°æ‰€æœ‰è¿›ç¨‹)
æ¯ä¸ªè¿›ç¨‹ï¼š
    1. æ¥æ”¶é…ç½®å˜æ›´å¹¿æ’­
    2. è§¦å‘ onConfigurationChanged() å›è°ƒ
    3. æ¸…é™¤å¸ƒå±€ç¼“å­˜ï¼ˆPreLoadManager.clearLayoutCache()ï¼‰
    4. æ¸…é™¤é€»è¾‘ç¼“å­˜ï¼ˆPreLoadManager.clearLogicCache()ï¼‰
    5. é‡æ–°é¢„åŠ è½½ï¼ˆPreLoadManager.run()ï¼‰  â† â­ ä¸»çº¿ç¨‹è€—æ—¶æ“ä½œï¼
    6. èµ„æºé‡è½½ï¼ˆResources reloadï¼‰
    7. è§†å›¾é‡å»º
```

##### å› ç´ 3ï¼šPreLoadManagerçš„åŒæ­¥é¢„åŠ è½½

**å…³é”®ä»£ç **ï¼š`src/com/android/provision/manager/PreLoadManager.java:306`

```java
Activity currentActivity = PreLoadActivityLifeCallback.getInstance().getCurrentActivity();
if (currentActivity != null) {
    run(currentActivity.getClass());  // âŒ åœ¨onConfigurationChangedå›è°ƒä¸­åŒæ­¥æ‰§è¡Œï¼
}
```

**é—®é¢˜**ï¼š
- `run()` æ–¹æ³•ä¼š**é¢„åŠ è½½å¤§é‡å¸ƒå±€å’Œèµ„æº**
- è¿™ä¸ªæ“ä½œåœ¨**ä¸»çº¿ç¨‹**çš„ `onConfigurationChanged()` å›è°ƒä¸­åŒæ­¥æ‰§è¡Œ
- å½“é…ç½®å˜æ›´å¹¿æ’­åˆ°è¾¾æ—¶ï¼Œä¸»çº¿ç¨‹æ­£åœ¨ç­‰å¾… `updatePersistentConfiguration()` è¿”å›
- ä½† `updatePersistentConfiguration()` è¦ç­‰æ‰€æœ‰è¿›ç¨‹å¤„ç†å®Œé…ç½®å˜æ›´æ‰èƒ½è¿”å›
- **å½¢æˆäº†é—´æ¥çš„å¾ªç¯ç­‰å¾…**ï¼

#### 3. å®Œæ•´çš„ç­‰å¾…é“¾æ¡ï¼ˆä¸ºä»€ä¹ˆè¶…è¿‡5ç§’ï¼‰

```
æ—¶é—´çº¿ï¼š

02:40:00.115  ç”¨æˆ·ç‚¹å‡»è¯­è¨€é€‰é¡¹ (ACTION_DOWN)
02:40:00.167  ç”¨æˆ·é‡Šæ”¾ç‚¹å‡» (ACTION_UP)
02:40:00.169  å¼€å§‹é…ç½®æ›´æ–° (locales updated)
              â†“
              ä¸»çº¿ç¨‹è°ƒç”¨ am.updatePersistentConfiguration(config)
              â†“ åŒæ­¥Binderç­‰å¾…
              system_server å¼€å§‹å¤„ç†
              â”œâ”€ æ›´æ–°å…¨å±€é…ç½®
              â”œâ”€ åˆ†å‘åˆ°æ‰€æœ‰Displayã€WindowContainer
              â””â”€ å¹¿æ’­é…ç½®å˜æ›´åˆ°æ‰€æœ‰è¿›ç¨‹
                  â†“
                  æ¯ä¸ªè¿›ç¨‹å¤„ç†é…ç½®å˜æ›´ï¼ˆåŒ…æ‹¬MiuiProvisionè‡ªå·±ï¼ï¼‰
                  â”œâ”€ onConfigurationChanged() å›è°ƒ
                  â”œâ”€ æ¸…é™¤ç¼“å­˜
                  â”œâ”€ é¢„åŠ è½½èµ„æºï¼ˆPreLoadManager.run()ï¼‰â† è€—æ—¶ï¼
                  â””â”€ è§†å›¾é‡å»º
              â†“ (ç­‰å¾…æ‰€æœ‰è¿›ç¨‹å®Œæˆ)
              
02:40:05.174  5ç§’åï¼Œsystem_serverå‘ç°ä¸»çº¿ç¨‹è¿˜åœ¨ç­‰å¾…
              â†“
              åˆ¤å®šä¸ºANRï¼ˆInput dispatching timeoutï¼‰
              
02:40:10.559  ANRæ­£å¼è§¦å‘ï¼Œç”Ÿæˆtraces

æ•´ä¸ªé“¾æ¡è€—æ—¶ > 10ç§’ï¼
```

#### 4. ä¸ºä»€ä¹ˆå¶ç°ï¼Ÿå…³é”®è§¦å‘æ¡ä»¶

**å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰ä¼šANR**ï¼š

1. âœ… **ç³»ç»Ÿç¹å¿™**ï¼šCPU/IOè´Ÿè½½é«˜ï¼Œè¿›ç¨‹å“åº”æ…¢
   - æœ¬æ¬¡æ—¥å¿—ä¸­ï¼šServiceManagerç­‰å¾…1ç§’ã€Binder warningã€å¤§é‡å¹¿æ’­é˜Ÿåˆ—

2. âœ… **é…ç½®å˜æ›´å¼€é”€å¤§**ï¼šéœ€è¦é‡è½½çš„èµ„æºå¤š
   - ä» `[]` (ç©º) å˜æ›´åˆ° `[ja_JP]` (æ—¥è¯­)
   - ç³»ç»Ÿæœ¬èº«ä¹Ÿåœ¨ä» `[]` å˜æ›´åˆ° `[en-GB]` (è‹±è¯­)
   - **ä¸¤æ¬¡é…ç½®å˜æ›´å åŠ ï¼**

3. âœ… **PreLoadManageré¢„åŠ è½½è€—æ—¶**ï¼š
   - LanguagePickerActivity éœ€è¦é¢„åŠ è½½çš„èµ„æºç‰¹åˆ«å¤š
   - æ¸…é™¤ç¼“å­˜ + é‡æ–°é¢„åŠ è½½ å¯èƒ½è€—æ—¶æ•°ç§’

4. âœ… **å¤šè¿›ç¨‹é…ç½®å›è°ƒè€—æ—¶å åŠ **ï¼š
   - ç³»ç»Ÿä¸­æ´»è·ƒè¿›ç¨‹å¤š
   - æ¯ä¸ªè¿›ç¨‹éƒ½éœ€è¦æ—¶é—´å¤„ç†é…ç½®å˜æ›´
   - æ€»è€—æ—¶ = Î£(æ¯ä¸ªè¿›ç¨‹çš„å¤„ç†æ—¶é—´)

**å¤§éƒ¨åˆ†æƒ…å†µä¸‹**ï¼š
- ç³»ç»Ÿä¸å¤ªç¹å¿™ï¼Œè¿›ç¨‹å“åº”å¿«
- é¢„åŠ è½½ç¼“å­˜å·²ç»å­˜åœ¨ï¼Œä¸éœ€è¦é‡å»º
- æ€»è€—æ—¶ < 5ç§’ï¼Œä¸è§¦å‘ANR

**å¶ç°æƒ…å†µä¸‹**ï¼ˆæœ¬æ¬¡æ•è·åˆ°çš„ï¼‰ï¼š
- ç³»ç»Ÿç¹å¿™ï¼ˆæ—¥å¿—è¯æ®å……åˆ†ï¼‰
- åŒé‡é…ç½®å˜æ›´ï¼ˆç³»ç»Ÿè¯­è¨€ + ç”¨æˆ·é€‰æ‹©ï¼‰
- é¢„åŠ è½½é‡å»ºè€—æ—¶
- å¤šè¿›ç¨‹å åŠ 
- **æ€»è€—æ—¶ > 5ç§’ï¼Œè§¦å‘ANR**

#### 5. ä¸ºä»€ä¹ˆåŒä¸€è®¾å¤‡å¤ç°ä¸¤æ¬¡ï¼Ÿ

**å‡Œæ™¨ 02:40** å’Œ **ä¸‹åˆ 14:49** ä¸¤æ¬¡å¤ç°ï¼Œè¯´æ˜ï¼š

1. âœ… **ç‰¹å®šè®¾å¤‡é…ç½®**ï¼šè¯¥æµ‹è¯•æœº(pudding_eea)å¯èƒ½ï¼š
   - é¢„åŠ è½½çš„èµ„æºç‰¹åˆ«å¤š
   - CPU/å†…å­˜é…ç½®ç›¸å¯¹è¾ƒä½
   - ç³»ç»Ÿä¸­è¿è¡Œçš„åå°è¿›ç¨‹å¤š

2. âœ… **ç‰¹å®šè¯­è¨€åˆ‡æ¢**ï¼šé€‰æ‹©æ—¥è¯­ï¼ˆja_JPï¼‰å¯èƒ½ï¼š
   - æ—¥è¯­èµ„æºæ–‡ä»¶è¾ƒå¤§
   - éœ€è¦é‡è½½çš„å­—ä½“/å¸ƒå±€èµ„æºå¤š
   - è§¦å‘äº†æ›´å¤šçš„ç¼“å­˜æ¸…é™¤å’Œé‡å»º

3. âœ… **é—®é¢˜æ ¹æºæœªä¿®å¤**ï¼š
   - ä»£ç ä¸­çš„1ç§’ç¦ç”¨æŒ‰é’®åªæ˜¯è§„é¿ï¼Œä¸èƒ½è§£å†³æ ¹æœ¬é—®é¢˜
   - å½“é…ç½®æ›´æ–°è€—æ—¶ > 5ç§’æ—¶ï¼Œå¿…ç„¶ANR
   - åœ¨è¯¥è®¾å¤‡ä¸Šï¼Œè¿™ä¸ªæ¡ä»¶**å®¹æ˜“æ»¡è¶³**

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¼‚æ­¥å¤„ç†é…ç½®æ›´æ–°ï¼ˆæ¨èï¼‰â­

**æ ¸å¿ƒæ€è·¯**ï¼šå°†`am.updatePersistentConfiguration(config)`ç§»åˆ°åå°çº¿ç¨‹æ‰§è¡Œ

#### ä¿®æ”¹æ–¹æ¡ˆ

**æ–‡ä»¶**ï¼š`src/com/android/provision/fragment/LanguagePickerFragment.java`

```java
private void setLanguage(int selectedPosition) {
    try {
        final IActivityManager am = ActivityManagerNative.getDefault();
        final Configuration config = am.getConfiguration();
        LocaleList locales = config.getLocales();
        Locale locale = mAdapter.getItem(selectedPosition).getLocale();
        boolean needChangeLocale;
        if(locales.size() == 1){
            Log.d(TAG, "old: "+locales.get(0).toString()+" select:" + (locale == null? "": locale.toString()));
            needChangeLocale = !locales.get(0).equals(locale);
        }else {
            needChangeLocale = true;
        }
        Log.d(TAG, "needChangeLocal "+needChangeLocale);
        if(needChangeLocale){
            config.setLocale(mAdapter.getItem(selectedPosition).getLocale());
            config.userSetLocale = true;
            
            // â­ æ–¹æ¡ˆ1ï¼šç§»åˆ°åå°çº¿ç¨‹æ‰§è¡Œ
            new AsyncTask<Void, Void, Boolean>() {
                @Override
                protected void onPreExecute() {
                    // å¯é€‰ï¼šæ˜¾ç¤ºåŠ è½½è¿›åº¦
                    showLoadingIfNeeded();
                }
                
                @Override
                protected Boolean doInBackground(Void... voids) {
                    try {
                        am.updatePersistentConfiguration(config);
                        // Trigger the dirty bit for the Settings Provider.
                        BackupManager.dataChanged("com.android.providers.settings");
                        return true;
                    } catch (RemoteException e) {
                        Log.e(TAG, "update default language failure", e);
                        return false;
                    }
                }
                
                @Override
                protected void onPostExecute(Boolean success) {
                    // éšè—åŠ è½½è¿›åº¦
                    hideLoadingIfNeeded();
                    if (success) {
                        DefaultPreferenceHelper.setFirstSetLanguage(false);
                    } else {
                        // å¤„ç†å¤±è´¥æƒ…å†µ
                        showErrorIfNeeded();
                    }
                }
            }.execute();
        } else {
            DefaultPreferenceHelper.setFirstSetLanguage(false);
        }
    } catch (RemoteException e) {
        Log.e(TAG, "update default language failure", e);
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å½»åº•è§£å†³ä¸»çº¿ç¨‹é˜»å¡é—®é¢˜
- âœ… ä¸å½±å“ç”¨æˆ·ä½“éªŒ
- âœ… ç¬¦åˆAndroidæœ€ä½³å®è·µ

**é£é™©è¯„ä¼°**ï¼š
- âš ï¸ éœ€è¦å……åˆ†æµ‹è¯•é…ç½®å˜æ›´çš„æ—¶åºé—®é¢˜
- âš ï¸ éœ€è¦ç¡®ä¿onConfigurationChangedå›è°ƒèƒ½æ­£å¸¸å¤„ç†

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨Handlerå»¶è¿Ÿæ‰§è¡Œ

**æ ¸å¿ƒæ€è·¯**ï¼šå»¶è¿Ÿæ‰§è¡Œé…ç½®æ›´æ–°ï¼Œè®©ä¸»çº¿ç¨‹æœ‰æ—¶é—´å¤„ç†å…¶ä»–äº‹ä»¶

```java
private void setLanguage(int selectedPosition) {
    // ... å‰é¢ä»£ç ä¸å˜ ...
    
    if(needChangeLocale){
        config.setLocale(mAdapter.getItem(selectedPosition).getLocale());
        config.userSetLocale = true;
        
        // â­ æ–¹æ¡ˆ2ï¼šå»¶è¿Ÿæ‰§è¡Œ
        new Handler(Looper.getMainLooper()).postDelayed(new Runnable() {
            @Override
            public void run() {
                try {
                    am.updatePersistentConfiguration(config);
                    BackupManager.dataChanged("com.android.providers.settings");
                    DefaultPreferenceHelper.setFirstSetLanguage(false);
                } catch (RemoteException e) {
                    Log.e(TAG, "update default language failure", e);
                }
            }
        }, 100); // å»¶è¿Ÿ100msï¼Œè®©ä¸»çº¿ç¨‹æœ‰æ—¶é—´å“åº”ç”¨æˆ·è¾“å…¥
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®ç°ç®€å•
- âœ… è®©ä¸»çº¿ç¨‹æœ‰æœºä¼šå“åº”å…¶ä»–äº‹ä»¶

**ç¼ºç‚¹**ï¼š
- âŒ ä»ç„¶åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¦‚æœè€—æ—¶è¿‡é•¿è¿˜æ˜¯ä¼šANR
- âŒ åªæ˜¯é™ä½æ¦‚ç‡ï¼Œä¸èƒ½æ ¹æ²»é—®é¢˜

### æ–¹æ¡ˆ3ï¼šä¼˜åŒ–PreLoadManagerçš„é…ç½®å˜æ›´å¤„ç†

**æ ¸å¿ƒæ€è·¯**ï¼šå°†PreLoadManager.onConfigurationChange()ä¸­çš„è€—æ—¶æ“ä½œç§»åˆ°åå°

**æ–‡ä»¶**ï¼š`src/com/android/provision/manager/PreLoadManager.java`

```java
public void onConfigurationChange(Configuration newConfig) {
    PreLoadLog.log(TAG, "oldConfig:" + lastConfigStr);
    String newConfigStr = convertCacheConfiguration(newConfig);
    boolean isDisplayConfigChange = lastConfigStr == null || !lastConfigStr.equals(newConfigStr);
    String newLanguageStr = convertLanguage(newConfig);
    boolean isLanguageChange = lastLanguageConfigStr == null || !lastLanguageConfigStr.equals(newLanguageStr);
    PreLoadLog.log(TAG, "newConfig:" + newConfigStr);
    if (isDisplayConfigChange) {
        PreLoadLog.log(TAG, "isDisplayConfigChange");
        clearLayoutCache();
        if (isLanguageChange) {
            PreLoadLog.log(TAG, "isLanguageChange");
            clearLogicCache();
        }
        //â­ å°†é‡æ–°åŠ è½½ç§»åˆ°åå°çº¿ç¨‹
        Activity currentActivity = PreLoadActivityLifeCallback.getInstance().getCurrentActivity();
        if (currentActivity != null) {
            final Class<?> activityClass = currentActivity.getClass();
            new AsyncTask<Void, Void, Void>() {
                @Override
                protected Void doInBackground(Void... voids) {
                    run(activityClass);  // åå°æ‰§è¡Œé¢„åŠ è½½
                    return null;
                }
            }.execute();
        }
    }
    lastConfigStr = newConfigStr;
    lastLanguageConfigStr = newLanguageStr;
}
```

### ğŸ¯ æ¨èæ–¹æ¡ˆ

**ç»¼åˆæ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ1ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰+ æ–¹æ¡ˆ3ï¼ˆä¼˜åŒ–PreLoadManagerï¼‰

1. âœ… **ç«‹å³ä¿®å¤**ï¼šé‡‡ç”¨æ–¹æ¡ˆ1ï¼Œå°†é…ç½®æ›´æ–°ç§»åˆ°åå°çº¿ç¨‹
2. âœ… **é•¿æœŸä¼˜åŒ–**ï¼šé‡‡ç”¨æ–¹æ¡ˆ3ï¼Œä¼˜åŒ–PreLoadManagerçš„æ€§èƒ½
3. âœ… **ç§»é™¤ä¸´æ—¶è§„é¿**ï¼šä¿®å¤åå¯ä»¥ç§»é™¤enableBtnClick()çš„1ç§’ç¦ç”¨é€»è¾‘

### æµ‹è¯•å»ºè®®

1. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•æ‰€æœ‰æ”¯æŒçš„è¯­è¨€åˆ‡æ¢
   - éªŒè¯é…ç½®å˜æ›´åUIæ­£å¸¸æ˜¾ç¤º
   - æµ‹è¯•å¿«é€Ÿè¿ç»­ç‚¹å‡»è¯­è¨€é€‰é¡¹

2. **æ€§èƒ½æµ‹è¯•**ï¼š
   - ä½¿ç”¨StrictModeæ£€æµ‹ä¸»çº¿ç¨‹é˜»å¡
   - ç›‘æ§é…ç½®æ›´æ–°çš„è€—æ—¶
   - æµ‹è¯•ä½å†…å­˜/é«˜è´Ÿè½½åœºæ™¯

3. **ç¨³å®šæ€§æµ‹è¯•**ï¼š
   - Monkeyæµ‹è¯•ï¼Œéšæœºç‚¹å‡»è¯­è¨€é€‰é¡¹
   - é•¿æ—¶é—´å‹åŠ›æµ‹è¯•
   - ä¸åŒè®¾å¤‡å‹å·æµ‹è¯•

4. **ANRç›‘æ§**ï¼š
   - éƒ¨ç½²åæŒç»­ç›‘æ§ANRç‡
   - æ”¶é›†ç”¨æˆ·åé¦ˆ
   - å®šæœŸreviewæ—¥å¿—

## ğŸ“Œ åˆ†æè¿›åº¦

- [x] ç¬¬ä¸€é˜¶æ®µï¼šå®Œæ•´ä¿¡æ¯æ”¶é›†ï¼ˆJiraè¯¦æƒ…ã€æ—¥å¿—ã€è¯„è®ºã€é™„ä»¶ï¼‰âœ…
- [x] ç¬¬äºŒé˜¶æ®µï¼šåˆ›å»ºå”¯ä¸€åˆ†ææ–‡æ¡£ âœ…
- [x] ç¬¬ä¸‰é˜¶æ®µï¼šâ­æ—¥å¿—æ—¶é—´éªŒè¯ï¼ˆå®Œç¾æ•è·é—®é¢˜ç°åœºï¼‰âœ…
- [x] ç¬¬å››é˜¶æ®µï¼šæ—¥å¿—æ—¶é—´çº¿åˆ†æï¼ˆå·²å®Œæˆå®Œæ•´æ—¶é—´çº¿é‡å»ºï¼‰âœ…
- [x] ç¬¬äº”é˜¶æ®µï¼šé—®é¢˜èŒƒå›´åˆ¤å®šï¼ˆç¡®è®¤ä¸ºMiuiProvisionåº”ç”¨å±‚é—®é¢˜ï¼‰âœ…
- [x] ç¬¬å…­é˜¶æ®µï¼šæ ¹å› åˆ†æä¸è§£å†³æ–¹æ¡ˆï¼ˆå·²è¯†åˆ«æ ¹å› å¹¶æä¾›3ç§è§£å†³æ–¹æ¡ˆï¼‰âœ…
- [x] ç¬¬ä¸ƒé˜¶æ®µï¼šä¿®å¤å®æ–½ï¼ˆå·²å®Œæˆä»£ç ä¿®æ”¹ï¼‰âœ…

**åˆ†æçŠ¶æ€**ï¼šâœ… **å·²å®Œæˆ** - é—®é¢˜æ ¹å› å·²æ˜ç¡®ï¼Œè§£å†³æ–¹æ¡ˆå·²å®æ–½

## ğŸ“ å…³é”®ç»“è®º

### é—®é¢˜æœ¬è´¨
â­ **ä¸»çº¿ç¨‹é˜»å¡å¯¼è‡´ANR**ï¼šLanguagePickerFragmentåœ¨ä¸»çº¿ç¨‹åŒæ­¥è°ƒç”¨`am.updatePersistentConfiguration(config)`è¿›è¡Œè¯­è¨€é…ç½®æ›´æ–°ï¼Œå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡è¶…è¿‡5ç§’è§¦å‘ANRã€‚

### å…³é”®è¯æ®
1. âœ… æ—¥å¿—å®Œç¾æ•è·ANRç°åœºï¼ˆ2025-10-11 02:40:10ï¼‰
2. âœ… ä»£ç ä¸­å­˜åœ¨å·²çŸ¥é—®é¢˜çš„è§„é¿é€»è¾‘ï¼ˆ1ç§’ç¦ç”¨æŒ‰é’®é˜²æ­¢é»‘å±ï¼‰
3. âœ… é…ç½®æ›´æ–°è§¦å‘å¤§é‡è€—æ—¶æ“ä½œï¼ˆç¼“å­˜æ¸…é™¤ã€é¢„åŠ è½½ã€èµ„æºé‡è½½ï¼‰

### æ¨èè§£å†³æ–¹æ¡ˆ
â­ **æ–¹æ¡ˆ1ï¼ˆæ¨èï¼‰**ï¼šå°†`am.updatePersistentConfiguration(config)`ç§»åˆ°åå°çº¿ç¨‹ï¼ˆAsyncTaskï¼‰æ‰§è¡Œ  
â­ **æ–¹æ¡ˆ3ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰**ï¼šä¼˜åŒ–PreLoadManagerçš„onConfigurationChangeï¼Œå°†é¢„åŠ è½½ç§»åˆ°åå°

### ä¼˜å…ˆçº§å’Œæ—¶é—´
- **é—®é¢˜ä¼˜å…ˆçº§**ï¼šP3 EEA1.0 BCé—®é¢˜
- **è¦æ±‚å®Œæˆæ—¶é—´**ï¼š2025-10-20
- **å»ºè®®ä¼˜å…ˆçº§**ï¼šé«˜ï¼ˆè™½ç„¶å¶ç°ï¼Œä½†å½±å“ç”¨æˆ·ä½“éªŒï¼Œä¸”å·²æœ‰æ˜ç¡®è§£å†³æ–¹æ¡ˆï¼‰

## ğŸ“ å¤‡æ³¨

1. â­ **é‡å¤§å‘ç°**ï¼šæ—¥å¿—é‡‡é›†æ—¶åˆ»æ°å¥½å‘ç”Ÿäº†åŒç±»ANRï¼Œå®Œç¾æ•è·é—®é¢˜ç°åœº
2. â­ **å·²çŸ¥é—®é¢˜**ï¼šä»£ç ä¸­å·²æœ‰1ç§’ç¦ç”¨æŒ‰é’®çš„ä¸´æ—¶è§„é¿æ–¹æ¡ˆï¼Œè¯´æ˜å›¢é˜Ÿå·²ç»æ„è¯†åˆ°æ­¤é—®é¢˜
3. â­ **é—®é¢˜å½±å“**ï¼šè™½ç„¶å¶ç°ï¼Œä½†åŒä¸€è®¾å¤‡åœ¨ä¸åŒæ—¶é—´ä¸¤æ¬¡å¤ç°ï¼ˆ02:40å’Œ14:49ï¼‰ï¼Œè¯´æ˜é—®é¢˜ç¨³å®šå­˜åœ¨
4. âœ… **å¯ä¿®å¤æ€§**ï¼šæ ¹å› æ˜ç¡®ï¼Œè§£å†³æ–¹æ¡ˆæ¸…æ™°ï¼Œé£é™©å¯æ§
5. âš ï¸ **æµ‹è¯•å»ºè®®**ï¼šä¿®å¤åéœ€è¦å……åˆ†æµ‹è¯•æ‰€æœ‰è¯­è¨€åˆ‡æ¢åœºæ™¯å’Œé…ç½®å˜æ›´å›è°ƒ

## ğŸ”§ ä¿®å¤å®æ–½è®°å½•

### ä¿®å¤æ—¶é—´
**2025-10-15**

### ä¿®å¤æ–¹æ¡ˆ
é‡‡ç”¨**ç»¼åˆæ–¹æ¡ˆ**ï¼šæ–¹æ¡ˆ1ï¼ˆå¼‚æ­¥å¤„ç†é…ç½®æ›´æ–°ï¼‰+ æ–¹æ¡ˆ3ï¼ˆä¼˜åŒ–PreLoadManagerï¼‰

### ä¿®æ”¹æ–‡ä»¶æ¸…å•

#### 1. LanguagePickerFragment.java
**æ–‡ä»¶è·¯å¾„**ï¼š`src/com/android/provision/fragment/LanguagePickerFragment.java`  
**ä¿®æ”¹ä½ç½®**ï¼š
- ç¬¬32-33è¡Œï¼ˆimportè¯­å¥ï¼Œæ·»åŠ ThreadUtilsï¼‰
- ç¬¬357-405è¡Œï¼ˆ`setLanguage()` æ–¹æ³•ï¼‰

**ä¿®æ”¹å†…å®¹**ï¼š
- å¼•å…¥ `ThreadUtils` å·¥å…·ç±»
- **ä»…ä¿®æ”¹å¯¼è‡´ANRçš„æ ¸å¿ƒé—®é¢˜**ï¼šå°† `am.updatePersistentConfiguration(config)` å’Œ `BackupManager.dataChanged()` ç§»åˆ°ThreadUtilsåå°çº¿ç¨‹æ‰§è¡Œ
- ä¸»çº¿ç¨‹ä¸å†é˜»å¡ç­‰å¾…é…ç½®æ›´æ–°å®Œæˆ
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼Œä¾¿äºåç»­è¿½è¸ª
- ä½¿ç”¨ThreadUtilsè€ŒéAsyncTaskï¼Œç¬¦åˆé¡¹ç›®ç»Ÿä¸€çš„çº¿ç¨‹ç®¡ç†è§„èŒƒ
- **éµå¾ªæœ€å°ä¿®æ”¹åŸåˆ™**ï¼šå…¶ä»–AsyncTaskï¼ˆgoNext()ã€DelayTaskï¼‰ä¿æŒåŸæ ·ï¼Œä¸åšä¿®æ”¹

**å…³é”®ä»£ç **ï¼š
```java
import com.android.provision.utils.*;

private void setLanguage(int selectedPosition) {
    // åœ¨ä¸»çº¿ç¨‹è·å–å¿…è¦çš„æ•°æ®ï¼Œé¿å…åå°çº¿ç¨‹è®¿é—®UIç»„ä»¶
    final Locale selectedLocale = mAdapter.getItem(selectedPosition).getLocale();
    
    // MUT-471905 ä¿®å¤ï¼šå°†é…ç½®æ›´æ–°ç§»åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡å¯¼è‡´ANR
    // æ ¹å› ï¼šam.updatePersistentConfiguration(config) æ˜¯åŒæ­¥Binderè°ƒç”¨ï¼Œå¯èƒ½è€—æ—¶è¶…è¿‡5ç§’
    // ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨ThreadUtilsåœ¨åå°çº¿ç¨‹æ‰§è¡Œé…ç½®æ›´æ–°å’Œå¤‡ä»½æ“ä½œ
    ThreadUtils.postOnBackgroundThread(() -> {
        try {
            IActivityManager am = ActivityManagerNative.getDefault();
            Configuration config = am.getConfiguration();
            LocaleList locales = config.getLocales();
            boolean needChangeLocale;
            if (locales.size() == 1) {
                Log.d(TAG, "old: " + locales.get(0).toString() + " select:" + (selectedLocale == null ? "" : selectedLocale.toString()));
                needChangeLocale = !locales.get(0).equals(selectedLocale);
            } else {
                needChangeLocale = true;
            }
            Log.d(TAG, "needChangeLocal " + needChangeLocale);
            if (needChangeLocale) {
                config.setLocale(selectedLocale);
                config.userSetLocale = true;
                am.updatePersistentConfiguration(config);
            }

            // Trigger the dirty bit for the Settings Provider.
            BackupManager.dataChanged("com.android.providers.settings");
        } catch (RemoteException e) {
            Log.e(TAG, "update default language failure", e);
        }
        DefaultPreferenceHelper.setFirstSetLanguage(false);
    });
}
```

**çº¿ç¨‹å®‰å…¨å¤„ç†**ï¼š
- åœ¨ä¸»çº¿ç¨‹é¢„å…ˆè·å– `selectedLocale`ï¼Œé¿å…åå°çº¿ç¨‹è®¿é—®UIç»„ä»¶ `mAdapter`
- ä½¿ç”¨ lambda è¡¨è¾¾å¼ç®€åŒ–ä»£ç ï¼Œæé«˜å¯è¯»æ€§
- æ•´ä¸ªé…ç½®æ›´æ–°é€»è¾‘ç»Ÿä¸€åœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œé¿å…ä¸»çº¿ç¨‹é˜»å¡

#### 2. PreLoadManager.java
**æ–‡ä»¶è·¯å¾„**ï¼š`src/com/android/provision/manager/PreLoadManager.java`  
**ä¿®æ”¹ä½ç½®**ï¼šç¬¬1-10è¡Œï¼ˆimportè¯­å¥ï¼‰ã€ç¬¬290-328è¡Œï¼ˆ`onConfigurationChange()` æ–¹æ³•ï¼‰  
**ä¿®æ”¹å†…å®¹**ï¼š
- å¼•å…¥ `ThreadUtils` å·¥å…·ç±»
- å°†é¢„åŠ è½½æ“ä½œ `run(activityClass)` ç§»åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼Œä½¿ç”¨ThreadUtils
- é¿å…åœ¨ `onConfigurationChanged()` å›è°ƒä¸­åŒæ­¥æ‰§è¡Œè€—æ—¶çš„é¢„åŠ è½½æ“ä½œ
- å‡å°‘é…ç½®å˜æ›´æ—¶çš„ä¸»çº¿ç¨‹é˜»å¡æ—¶é—´
- ä½¿ç”¨ThreadUtilsè€ŒéAsyncTaskï¼Œç¬¦åˆé¡¹ç›®ç»Ÿä¸€çš„çº¿ç¨‹ç®¡ç†è§„èŒƒ

**å…³é”®ä»£ç **ï¼š
```java
import com.android.provision.utils.ThreadUtils;

// MUT-471905 ä¿®å¤ï¼šå°†é¢„åŠ è½½æ“ä½œç§»åˆ°åå°çº¿ç¨‹ï¼Œé¿å…åœ¨onConfigurationChangedå›è°ƒä¸­é˜»å¡ä¸»çº¿ç¨‹
Activity currentActivity = PreLoadActivityLifeCallback.getInstance().getCurrentActivity();
if (currentActivity != null) {
    final Class<?> activityClass = currentActivity.getClass();
    ThreadUtils.postOnBackgroundThread(new Runnable() {
        @Override
        public void run() {
            PreLoadLog.log(TAG, "Preloading resources in background thread for: " + activityClass.getSimpleName());
            PreLoadManager.this.run(activityClass);  // åå°æ‰§è¡Œé¢„åŠ è½½
            ThreadUtils.postOnMainThread(new Runnable() {
                @Override
                public void run() {
                    PreLoadLog.log(TAG, "Background preload completed for: " + activityClass.getSimpleName());
                }
            });
        }
    });
}
```

### ä¿®å¤æ•ˆæœé¢„æœŸ

1. **ä¸»çº¿ç¨‹ä¸å†é˜»å¡**ï¼š
   - é…ç½®æ›´æ–°æ“ä½œåœ¨åå°çº¿ç¨‹æ‰§è¡Œ
   - ä¸»çº¿ç¨‹èƒ½å¤ŸåŠæ—¶å“åº”ç”¨æˆ·è¾“å…¥
   - ä¸ä¼šè§¦å‘5ç§’è¶…æ—¶ANR

2. **æ€§èƒ½æå‡**ï¼š
   - å‡å°‘é…ç½®å˜æ›´æ—¶çš„ä¸»çº¿ç¨‹é˜»å¡æ—¶é—´
   - é¢„åŠ è½½æ“ä½œä¸å½±å“UIå“åº”
   - æå‡è¯­è¨€åˆ‡æ¢çš„æµç•…åº¦

3. **ç¨³å®šæ€§æ”¹å–„**ï¼š
   - å½»åº•è§£å†³å¶ç°ANRé—®é¢˜
   - å³ä½¿åœ¨ç³»ç»Ÿç¹å¿™æ—¶ä¹Ÿä¸ä¼šå¡æ­»
   - å‡å°‘ç”¨æˆ·æŠ•è¯‰å’Œé—®é¢˜å¤ç°

### åç»­æµ‹è¯•å»ºè®®

1. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - æµ‹è¯•æ‰€æœ‰æ”¯æŒçš„è¯­è¨€åˆ‡æ¢ï¼ˆç‰¹åˆ«æ˜¯æ—¥è¯­ja_JPï¼‰
   - éªŒè¯é…ç½®å˜æ›´åUIæ­£å¸¸æ˜¾ç¤º
   - æµ‹è¯•å¿«é€Ÿè¿ç»­ç‚¹å‡»è¯­è¨€é€‰é¡¹

2. **æ€§èƒ½æµ‹è¯•**ï¼š
   - ä½¿ç”¨StrictModeæ£€æµ‹ä¸»çº¿ç¨‹é˜»å¡
   - ç›‘æ§é…ç½®æ›´æ–°çš„è€—æ—¶
   - æµ‹è¯•ä½å†…å­˜/é«˜è´Ÿè½½åœºæ™¯

3. **ç¨³å®šæ€§æµ‹è¯•**ï¼š
   - Monkeyæµ‹è¯•ï¼Œéšæœºç‚¹å‡»è¯­è¨€é€‰é¡¹
   - é•¿æ—¶é—´å‹åŠ›æµ‹è¯•
   - åœ¨æµ‹è¯•æœºpudding_eeaä¸Šé‡ç‚¹æµ‹è¯•

4. **å›å½’æµ‹è¯•**ï¼š
   - éªŒè¯å¼€æœºå¼•å¯¼å®Œæ•´æµç¨‹
   - ç¡®ä¿å…¶ä»–é¡µé¢é…ç½®å˜æ›´æ­£å¸¸
   - æ£€æŸ¥ANRæ—¥å¿—ï¼Œç¡®è®¤é—®é¢˜ä¸å†å¤ç°

### é£é™©è¯„ä¼°

**é£é™©ç­‰çº§**ï¼šä½

**é£é™©åˆ†æ**ï¼š
1. ThreadUtilsæ˜¯é¡¹ç›®ç»Ÿä¸€çš„çº¿ç¨‹ç®¡ç†å·¥å…·ç±»ï¼Œå·²åœ¨å¤šå¤„ä½¿ç”¨ï¼ˆFontStyleFragmentã€SimCardDetectionFragmentã€PreinstallAppManagerç­‰ï¼‰ï¼Œæˆç†Ÿç¨³å®š
2. **éµå¾ªæœ€å°ä¿®æ”¹åŸåˆ™**ï¼šä»…ä¿®æ”¹å¯¼è‡´ANRçš„ä¸¤å¤„æ ¸å¿ƒé—®é¢˜ï¼Œå…¶ä»–ä»£ç ä¿æŒåŸæ ·
3. é…ç½®æ›´æ–°çš„å¼‚æ­¥åŒ–ä¸å½±å“åŠŸèƒ½æ­£ç¡®æ€§
4. åŸæœ‰çš„1ç§’ç¦ç”¨æŒ‰é’®é€»è¾‘ä¿æŒä¸å˜ï¼Œä½œä¸ºé¢å¤–ä¿éšœ
5. ä¿®æ”¹é€»è¾‘æ¸…æ™°ï¼Œä¸æ¶‰åŠå¤æ‚çš„çŠ¶æ€ç®¡ç†
6. é™ä½å›å½’é£é™©ï¼šæœªä¿®æ”¹çš„AsyncTaskï¼ˆgoNext()ã€DelayTaskï¼‰ç»§ç»­ä¿æŒåŸæœ‰è¡Œä¸º

**ç¼“è§£æªæ–½**ï¼š
1. å……åˆ†æµ‹è¯•æ‰€æœ‰è¯­è¨€åˆ‡æ¢åœºæ™¯
2. ç›‘æ§çº¿ä¸ŠANRç‡ï¼ŒåŠæ—¶å‘ç°é—®é¢˜
3. ä¿ç•™è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
4. å¦‚æœ‰é—®é¢˜å¯å¿«é€Ÿå›æ»š

## ğŸ”— ç›¸å…³é“¾æ¥

- **Jiraé—®é¢˜å•**ï¼šhttps://jira-phone.mioffice.cn/browse/MUT-471905
- **Kpanæ—¥å¿—é“¾æ¥**ï¼šhttps://kpan.mioffice.cn/webfolder/ext/1susVE9sj5D%24uVm31GQvyw%40%40?n=0.9704619535669977ï¼ˆå¯†ç ï¼š5XTzï¼‰
- **ææ•ˆå·¥å…·æ—¥å¿—**ï¼šhttps://cnbj1-fds.api.xiaomi.net/jira-logs/MUT-471905.zip
- **æœ¬åœ°æ—¥å¿—è·¯å¾„**ï¼š`/mnt/01_lixin_workspace/miui_apps/MiuiProvisionAosp/logs/MUT-471905_files/`

---
**æ–‡æ¡£åˆ›å»ºæ—¶é—´**ï¼š2025-10-14  
**ä¿®å¤å®æ–½æ—¶é—´**ï¼š2025-10-15  
**åˆ†æäººå‘˜**ï¼šAIåŠ©æ‰‹  
**åˆ†ææ–¹æ³•**ï¼šåŸºäºJiraé—®é¢˜åˆ†ææ ‡å‡†æµç¨‹ v2025.10.14  
**æ–‡æ¡£çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå®Œæ•´åˆ†æå¹¶å®æ–½ä¿®å¤  
**åç»­è¡ŒåŠ¨**ï¼šä»£ç å®¡æŸ¥ â†’ æµ‹è¯•éªŒè¯ â†’ æäº¤ä»£ç  â†’ è·Ÿè¸ªçº¿ä¸Šæ•ˆæœ

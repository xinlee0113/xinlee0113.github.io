<!-- PlantUML在线渲染辅助工具 - 使用Kroki.io服务（支持CORS） -->
<script>
  // 使用Kroki.io服务（支持CORS，开源免费）
  const KROKI_SERVER = 'https://kroki.io';
  
  // 自动渲染页面中的PlantUML代码块
  document.addEventListener('DOMContentLoaded', function() {
    // 查找所有标记为plantuml的代码块
    const plantumlBlocks = document.querySelectorAll('code.language-plantuml');
    
    plantumlBlocks.forEach(async function(codeBlock) {
      const code = codeBlock.textContent.trim();
      
      try {
        // 使用Kroki的POST API（支持CORS）
        const response = await fetch(`${KROKI_SERVER}/plantuml/svg`, {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain',
          },
          body: code
        });
        
        if (response.ok) {
          const svgText = await response.text();
          
          // 创建div容器
          const container = document.createElement('div');
          container.className = 'plantuml-diagram';
          container.innerHTML = svgText;
          
          // 替换代码块为图表
          const pre = codeBlock.parentNode;
          if (pre && pre.tagName === 'PRE') {
            pre.parentNode.replaceChild(container, pre);
          }
        } else {
          const errorText = await response.text();
          throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 100)}`);
        }
      } catch (error) {
        // 如果失败，显示错误信息
        const errorDiv = document.createElement('div');
        errorDiv.className = 'plantuml-error';
        errorDiv.innerHTML = `
          <p><strong>⚠️ PlantUML图表渲染失败</strong></p>
          <details open>
            <summary>查看源代码</summary>
            <pre><code>${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
          </details>
          <p><small>错误：${error.message}</small></p>
          <p><small>提示：检查PlantUML语法是否正确，或尝试刷新页面</small></p>
          <p><small>服务器：<a href="https://kroki.io" target="_blank">Kroki.io</a></small></p>
        `;
        
        const pre = codeBlock.parentNode;
        if (pre && pre.tagName === 'PRE') {
          pre.parentNode.replaceChild(errorDiv, pre);
        }
      }
    });
  });
</script>

<style>
  /* PlantUML图表样式 */
  .plantuml-diagram {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 20px auto;
    border: 1px solid #e1e4e8;
    border-radius: 6px;
    padding: 10px;
    background-color: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.12);
  }
  
  .plantuml-diagram:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  
  /* PlantUML错误提示样式 */
  .plantuml-error {
    margin: 20px auto;
    padding: 15px;
    border: 2px solid #ff6b6b;
    border-radius: 6px;
    background-color: #fff5f5;
    color: #c92a2a;
  }
  
  .plantuml-error details {
    margin-top: 10px;
    padding: 10px;
    background-color: #fff;
    border: 1px solid #ffe0e0;
    border-radius: 4px;
  }
  
  .plantuml-error summary {
    cursor: pointer;
    color: #c92a2a;
    font-weight: bold;
  }
  
  .plantuml-error pre {
    margin: 10px 0 0 0;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 4px;
    overflow-x: auto;
  }
  
  .plantuml-error code {
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
  }
</style>


